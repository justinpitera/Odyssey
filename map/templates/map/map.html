{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <!-- Meta tags for mobile -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="Odyssey">
        <link rel="apple-touch-icon" href="static/images/favicon.ico">

        <link rel="stylesheet" href="{% static 'map/css/styles.css' %}">
        <script src='https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css' rel='stylesheet' />
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{page_title}}</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/gh/eliyantosarage/font-awesome-pro@main/fontawesome-pro-6.5.1-web/css/all.min.css" rel="stylesheet">
        <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.ico' %}" >
    </head>
    <body data-user-id="{{user.id}}">
        <body data-user-id="{{user.id}}">
            <div id="loading-screen" class="loading-screen">
                <div class="loading-content">
                    <h1>Simtrail is loading...</h1>
                    <div class="progress-bar mt-10">
                        <div class="progress" id="progress"></div>
                    </div>
                </div>
            </div>
            
            <script>
                window.addEventListener('load', function() {
                    const loadingScreen = document.getElementById('loading-screen');
                    const progressBar = document.getElementById('progress');
                    
                    if (window.map) {
                        if (loadingScreen) {
                            loadingScreen.style.display = 'flex'; // Show loading screen
                        }
                        
                        // Simulate initial progress (optional, can be removed if not needed)
                        progressBar.style.width = '50%';
                        
                        map.on('idle', function() {
                            // Set progress to 100% when the map is fully loaded
                            progressBar.style.width = '100%';
                            
                            // Hide the loading screen after a slight delay to show completion
                            setTimeout(() => {
                                if (loadingScreen) {
                                    loadingScreen.style.display = 'none';
                                }
                            }, 500); // Adjust delay as needed
                        });
                    }
                });
                
            </script>


        <div id="menu-toggle" class="fixed top-1/2 left-0 transform -translate-y-1/2 z-30 transition-transform duration-300 ease-in-out">
            <button id="toggle-btn" class="bg-gray-700 opacity-75 p-4 rounded-r-lg shadow-lg">
                <i id="toggle-icon" class="fas fa-bars text-white"></i>
            </button>
        </div>
        

<!-- Sidebar Container -->
<div id="sidebar" class="fixed inset-y-0 left-0 z-50 flex flex-col w-64 md:w-84 lg:w-96 bg-gray-800 text-white transform -translate-x-full transition-transform duration-300 ease-in-out shadow-xl">
    <!-- Sidebar Content -->
    <div class="flex-1 overflow-y-auto p-5">
        <!-- Sidebar Header / Close Button -->
        <div class="flex items-center justify-between mb-10">
            <h2 class="text-xl font-semibold">Simtrail</h2>

        </div>

        <!-- Section 1: My Stuff -->
        <div class="space-y-1 mb-8">
            <h3 class="text-lg font-semibold mb-2 pl-2">My Stuff</h3>
            <a href="#" class="flex items-center p-2 text-base font-normal text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600">
                <i class="fa-solid fa-paper-plane w-6"></i>
                <span class="ml-3">Flight Planner</span>
            </a>
            <a href="#" class="flex items-center p-2 text-base font-normal text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600">
                <i class="fas fa-book w-6"></i>
                <span class="ml-3">Logbook</span>
            </a>
            <a href="#" class="flex items-center p-2 text-base font-normal text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600">
                <i class="fa-solid fa-gamepad"></i>
                <span class="ml-3">Remote Control</span>
            </a>
        </div>

        <!-- Section 2: Network -->
        <div class="space-y-1 mb-8">
            <h3 class="text-lg font-semibold mb-2 pl-2">Network</h3>
            <a href="#" class="flex items-center p-2 text-base font-normal text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600">
                <i class="fas fa-calendar-alt w-6"></i>
                <span class="ml-3">Events</span>
            </a>
            <a href="#" class="flex items-center p-2 text-base font-normal text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600">
                <i class="fa-regular fa-people-group w-6"></i>
                <span class="ml-3">Virtual Airlines</span>
            </a>
            <a href="#" class="flex items-center p-2 text-base font-normal text-gray-300 bg-gray-700 rounded-lg hover:bg-gray-600">
                <i class="fas fa-trophy w-6"></i>
                <span class="ml-3">Achievements</span>
            </a>
        </div>




        <div class="space-y-1 mb-8">
            <h3 class="text-lg font-semibold mb-2 pl-2">Popular Airports</h3>
            <div class="bg-gray-700 rounded-lg p-2 hover:bg-gray-600">
                <p>JFK - New York</p>
            </div>
            <div class="bg-gray-700 rounded-lg p-2 hover:bg-gray-600">
                <p>LAX - Los Angeles</p>
            </div>
            <!-- Add more airports as needed -->
        </div>

        
        <div class="space-y-1 mb-8">
            <h3 class="text-lg font-semibold mb-2 pl-2">Featured Flights</h3>
            <div id="featured-flights" class="flex items-center space-x-2">
                <div class="w-1/4 opacity-50">Previous Flight</div>
                <div class="w-1/2 bg-gray-700 rounded-lg p-2">Current Flight</div>
                <div class="w-1/4 opacity-50">Next Flight</div>
            </div>
        </div>
        

        <div class="space-y-1 mb-8">
            <h3 class="text-lg font-semibold mb-2 pl-2">Upcoming Events</h3>
            <div class="bg-gray-700 rounded-lg p-2 hover:bg-gray-600">
                <p>Event 1 - Date</p>
            </div>
            <div class="bg-gray-700 rounded-lg p-2 hover:bg-gray-600">
                <p>Event 2 - Date</p>
            </div>
            <!-- Add more events as needed -->
        </div>
        

<!-- User Profile Section, Snapped to the Bottom -->
<div class="absolute bottom-0 left-0 px-5 py-4 w-full bg-gray-700">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <img src="https://via.placeholder.com/50" alt="User avatar" class="w-12 h-12 rounded-full">
            <div>
                <h2 class="text-lg font-semibold text-white">{{request.user.first_name}}</h2>
                <p class="text-sm text-gray-400">@{{request.user.username}}</p>
            </div>
        </div>
        <div class="flex items-center space-x-2 mt-3 left-2">
            <button class="text-white hover:text-gray-200 focus:outline-none">
                <i class="fas fa-cog fa-sm" style="font-size: 1.5em;"></i>
            </button>
            <button class="text-white hover:text-gray-200 ">
                <i class="fas fa-question-circle fa-sm" style="font-size: 1.5em;"></i>
            </button>
        </div>
    </div>
</div>


    </div>

</div>

<script>
// Simplified example to change flights. You should fetch actual data for implementation.
const flights = ['Flight 1', 'Flight 2', 'Flight 3']; // Example flight data
let currentFlightIndex = 0;

function updateFeaturedFlights() {
    const container = document.getElementById('featured-flights');
    container.children[0].textContent = flights[(currentFlightIndex - 1 + flights.length) % flights.length];
    container.children[1].textContent = flights[currentFlightIndex];
    container.children[2].textContent = flights[(currentFlightIndex + 1) % flights.length];
}

function changeFlight(direction) {
    currentFlightIndex += direction;
    if (currentFlightIndex < 0) currentFlightIndex = flights.length - 1;
    else if (currentFlightIndex >= flights.length) currentFlightIndex = 0;
    updateFeaturedFlights();
}

updateFeaturedFlights(); // Initialize

// Set interval to change flight every 15 seconds
setInterval(function() {
    changeFlight(1); // Move to the next flight
}, 15000); // 15000 milliseconds = 15 seconds


</script>


        <script>
            document.getElementById('toggle-btn').addEventListener('click', toggleSidebar);

            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const toggleIcon = document.getElementById('toggle-icon');
                const menuToggle = document.getElementById('menu-toggle');
                const isOpen = sidebar.classList.contains('translate-x-0');
            
                if (isOpen) {
                    // Close sidebar
                    sidebar.classList.replace('translate-x-0', '-translate-x-full');
                    // Move button back to the edge of the screen and preserve vertical centering
                    menuToggle.style.transform = 'translateX(0) translateY(-50%)';
                    // Change icon to menu (bars)
                    toggleIcon.classList.replace('fa-times', 'fa-bars');
                } else {
                    // Open sidebar
                    sidebar.classList.replace('-translate-x-full', 'translate-x-0');
                    // Move button with sidebar and preserve vertical centering
                    menuToggle.style.transform = `translateX(${sidebar.offsetWidth}px) translateY(-50%)`;
                    // Change icon to close (times)
                    toggleIcon.classList.replace('fa-bars', 'fa-times');
                }
            }
            
        </script>

        
        
        <div id="plan-flight-card" class="max-w-sm mx-auto bg-gray-800 text-white rounded-lg shadow-md overflow-hidden z-50" style="top:100px; left: 5%; z-index: 1000; position: absolute; display: none;">
            <div class="draggable-handle flex justify-between items-center p-2 cursor-move">
                <h1 class="text-xl font-semibold">Plan Flight</h1>
                <button id="close-flightplan-card-btn" class="text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200"><i class="fas fa-times"></i></button>
            </div>
            <div class="flex justify-center bg-gray-700">
                <img class="w-full object-cover" style="height: 300px;" src="{% static 'images/plan_flight_placeholder.jpg' %}" alt="Plane">
            </div>
            <div class="px-5 py-4">
                <div class="mb-4 departure-info" onclick="toggleInput('callsign')">
                    <div class="block text-sm font-medium">Callsign</div>
                    <div id="callsign" class="mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md w-full">Your Callsign</div>
                </div>
                <div class="mb-4 arrival-info" onclick="toggleInput('origin-airport')">
                    <div class="block text-sm font-medium">Origin Airport</div>
                    <div id="origin-airport" class="mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md w-full">Origin Airport</div>
                </div>
                <div class="mb-4 arrival-info" onclick="toggleInput('destination-airport')">
                    <div class="block text-sm font-medium">Destination Airport</div>
                    <div id="destination-airport" class="mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md w-full">Destination Airport</div>
                </div>
            </div>
        </div>
        
        <script>
            function toggleInput(inputId) {
                var inputElement = document.getElementById(inputId);
                var textValue = inputElement.textContent;
                var inputHtml = '<input type="text" class="mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md w-full" value="' + textValue + '">';
                inputElement.innerHTML = inputHtml;
                inputElement.getElementsByTagName('input')[0].focus();
                inputElement.onclick = function(event) {
                    event.stopPropagation();
                };
                inputElement.getElementsByTagName('input')[0].onblur = function() {
                    inputElement.innerHTML = inputElement.getElementsByTagName('input')[0].value;
                    inputElement.onclick = function() {
                        toggleInput(inputId);
                    };
                };
            }
        </script>
 
        
        <div id="search-bar" style="position: absolute; top: 50px; left: 50%; transform: translateX(-50%); z-index: 1000;">
            <input type="text" placeholder="Search..." id="search-input" style="padding: 10px 10px 10px 40px; width: 400px; border-radius: 20px;">
            <i class="fas fa-search" style="position: absolute; top: 15px; left: 10px; color: #aaa;"></i>
            <i class="fas fa-times" id="clear-input" style="position: absolute; top: 15px; right: 10px; color: #aaa; cursor: pointer;"></i>
            <div id="search-results" style="display: none; position: absolute; top: 105px; left: 50%; transform: translateX(-50%); background-color: white; border: 1px solid #aaa; border-radius: 5px; width: 400px; max-height: 300px; overflow-y: auto; z-index: 1001;"></div>
        </div>
        <script>
            const placeholders = [
                "Search for airports...",
                "Search for waypoints...",
                "Search by flight number...",
                "Search by username...",
                "Search by aircraft type...",
                "Search by pilot name...",
                "Search by frequency...",
                "Search by tower name...",
                "Search by VATSIM CID...",
                "Search by IVAO ID...",
            ];
        
            const searchInput = document.getElementById("search-input");
        
            function animatePlaceholder() {
                const randomIndex = Math.floor(Math.random() * placeholders.length);
                searchInput.placeholder = placeholders[randomIndex];
                setTimeout(animatePlaceholder, 3000); // Change every 3 seconds
            }
        
            animatePlaceholder(); // Start the animation
        </script>



        <div class="max-w-sm rounded overflow-hidden shadow-lg bg-white z-50" style="display:none; z-index: 1000;">
            <div class="px-6 py-4">
              <div class="font-bold text-xl mb-2">Aircraft Details</div>
              <p class="text-gray-700 text-base">
                <strong>Name:</strong> John Doe
              </p>
              <p class="text-gray-700 text-base">
                <strong>Groundspeed:</strong> 450 knots
              </p>
              <p class="text-gray-700 text-base">
                <strong>Altitude:</strong> 35,000 ft
              </p>
              <p class="text-gray-700 text-base">
                <strong>Heading:</strong> 90°
              </p>
              <p class="text-gray-700 text-base">
                <strong>VATSIM ID:</strong> 123456
              </p>
            </div>
          </div>
          



        
          <div id="airport-card" style="display: none; position: absolute; top: 40%; left: 10%; transform: translateY(-50%); z-index: 1000;" class="max-w-2xl mx-auto bg-white rounded-lg border border-gray-200 shadow-md dark:bg-gray-800 dark:border-gray-700 z-50">
            <div class="draggable-handle flex justify-between items-center p-2 cursor-move">
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Loading...</h5>
                <button id="close-airport-card-btn" class="text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200"><i class="fas fa-times"></i></button>
            </div>
            <!-- Tabs -->
            <ul id="tabs" class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700">
                <li class="mr-2">
                    <a href="#" class="inline-block p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" onclick="changeTab('details')"><i class="fa-regular fa-circle-info"></i> Airport Details</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="inline-block p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" onclick="changeTab('arrivals')"><i class="fa-regular fa-plane-arrival"></i> Arrivals</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="inline-block p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" onclick="changeTab('departures')"><i class="fa-regular fa-plane-departure"></i> Departures</a>
                </li>

            </ul>
            
            <!-- Tab Contents -->
            <div id="tabContents">
                <div id="details" class="hidden p-4">
                    <p class="text-gray-700 dark:text-gray-400">Airport Details content...</p>
                </div>
                <div id="arrivals" class="hidden p-4">
                    <p class="text-gray-700 dark:text-gray-400">Arrivals content...</p>
                </div>
                <div id="departures" class="hidden p-4">
                    <p class="text-gray-700 dark:text-gray-400">Departures content...</p>
                </div>

            </div>
            </div>
        </div>

        <div id="airport-card" style="display: none; position: absolute; top: 40%; left: 10%; transform: translateY(-50%); z-index: 1000;" class="max-w-2xl mx-auto bg-white rounded-lg border border-gray-200 shadow-md dark:bg-gray-800 dark:border-gray-700 z-50">
            <div class="draggable-handle flex justify-between items-center p-2 cursor-move">
                <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Airport Name</h5>
                <button id="close-card-btn" class="text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200"><i class="fas fa-times"></i></button>
            </div>
            <!-- Tabs -->
            <ul id="tabs" class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700">
                <li class="mr-2">
                    <a href="#" class="inline-block p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" onclick="changeTab('details')"><i class="fa-regular fa-circle-info"></i> Airport Details</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="inline-block p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" onclick="changeTab('arrivals')"><i class="fa-regular fa-plane-arrival"></i> Arrivals</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="inline-block p-4 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300" onclick="changeTab('departures')"><i class="fa-regular fa-plane-departure"></i> Departures</a>
                </li>

            </ul>
            
            <!-- Tab Contents -->
            <div id="tabContents">
                <div id="details" class="hidden p-4">
                    <p class="text-gray-700 dark:text-gray-400">Airport Details content...</p>
                </div>
                <div id="arrivals" class="hidden p-4">
                    <p class="text-gray-700 dark:text-gray-400">Arrivals content...</p>
                </div>
                <div id="departures" class="hidden p-4">
                    <p class="text-gray-700 dark:text-gray-400">Departures content...</p>
                </div>

            </div>
            </div>
        </div>
        
            <!-- Wrap toolbar and filters menu in a container -->
    <div style="position: absolute; bottom: 25px; right: 20px; z-index: 35; display: flex;">
        <!-- Map toolbar -->
        <div id="map-toolbar" class="flex m-2">
            <select id="styleSelector" class="toolbar-select">
                <option value="mapbox://styles/mapbox/dark-v10" selected>Dark</option>
                <option value="mapbox://styles/mapbox/light-v10">Light</option>
                <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
            </select>
            <button id="rc-btn" class="toolbar-btn">
                <i class="fa-solid fa-gamepad"></i>
            </button>
            <button id="toggle-rotation" class="toolbar-btn">
                <i class="fa-solid fa-magnifying-glass-arrows-rotate"></i>
            </button>
            <button id="filters-btn" class="toolbar-btn">
                <i class="fas fa-filter"></i>
            </button>
        </div>

        <!-- Filters menu, initially hidden -->
        <div id="filters-menu" class="hidden absolute bottom-20 right-0 bg-white bg-opacity-80 backdrop-blur-sm shadow-lg rounded-lg p-4 max-w-xs w-full">
            <div class="font-semibold text-lg mb-2">Filters</div>
            <div class="flex flex-col">
                <span class="font-medium mb-1">Aircraft</span>
                <label class="inline-flex items-center mb-1">
                    <input id="simtrailFilter" type="checkbox" class="form-checkbox h-5 w-5 text-blue-600"><span class="ml-2">Simtrail Aircraft</span>
                </label>
                <label class="inline-flex items-center mb-1">
                    <input id="vatsimFilter" type="checkbox" class="form-checkbox h-5 w-5 text-blue-600"><span class="ml-2">Vatsim Aircraft</span>
                </label>
                <label class="inline-flex items-center mb-1">
                    <input id="ivaoFilter" type="checkbox" class="form-checkbox h-5 w-5 text-blue-600"><span class="ml-2">IVAO Aircraft</span>
                </label>
                
                <span class="font-medium mt-3 mb-1">Locations</span>
                <label class="inline-flex items-center mb-1">
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-green-500"><span class="ml-2">Large Airports</span>
                </label>
                <label class="inline-flex items-center mb-1">
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-green-500"><span class="ml-2">Medium Airports</span>
                </label>
                <label class="inline-flex items-center mb-1">
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-green-500"><span class="ml-2">Small Airports</span>
                </label>
                <label class="inline-flex items-center mb-1">
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-green-500"><span class="ml-2">Heliports</span>
                </label>
            </div>
        </div>
    </div>
        

        <div id="map"></div>





        <!-- Define the base URL for static files -->
        <script type="text/javascript">
            var staticBaseUrl = "{% static '' %}";
        </script>

        
        
        <script>
            mapboxgl.accessToken = 'pk.eyJ1Ijoib2R5c3NleWNsaWVudCIsImEiOiJjbHQ2MGh2NDMwNmE2MnJvZXhwdWIwZmJpIn0._1PC-pg9OaMJldN9svTWwg';
            const map = new mapboxgl.Map({
                container: 'map', // container ID
                style: 'mapbox://styles/mapbox/dark-v11', // Initial map style
                center: [0, 0], // Starting position
                zoom: 1, // Starting zoom
                projection: 'globe' // Enable the globe projection
            });

            map.addControl(new mapboxgl.NavigationControl());
            map.on('load', () => {

                // Add fog to create a misty effect, especially at higher altitudes or distances
                map.setFog({
                    'range': [0, 1.5],
                    'color': '#4e4e52', // Adjust the color to fit the dark theme
                    'horizon-blend': 0.04,
                });

                // Set light to simulate a moonlight or low-light condition for a darker sky effect
                map.setLight({
                    'anchor': 'viewport',
                    'color': '#8899AA',
                    'intensity': 0.3
                });
            });
            document.addEventListener('DOMContentLoaded', function() {
                var savedStyle = localStorage.getItem('mapStyle');
                if (savedStyle) {
                    // Set the map style to the saved value
                    map.setStyle(savedStyle);
            
                    // Change the dropdown to match the saved style
                    var styleSelector = document.getElementById('styleSelector');
                    styleSelector.value = savedStyle;
            
                    // Depending on how your setup functions work, you might need to call them here.
                    // For example, if they depend on the map style being set, and don't handle the style.load event internally.
                    // drawWaypointsAndRoute();
                    // startImage();
                    // startIVAOImage();
                    // Note: Ensure these functions can handle being called here without causing issues when the map style changes.
                }
            });
            

        document.getElementById('styleSelector').addEventListener('change', function() {
            var selectedStyle = this.value;
            map.setStyle(selectedStyle);

            // Save the selected style to local storage
            localStorage.setItem('mapStyle', selectedStyle);

            // Because setStyle will remove and re-add all layers/sources, wait for the style to load before re-adding them
            map.once('style.load', () => {
                // Ensure this function can handle being called multiple times
                drawWaypointsAndRoute();
                
                startImage();
                startIVAOImage();
                
                // Reapply fog, light, and atmosphere settings since setStyle removes them
                map.setFog({
                    'range': [0, 1.5],
                    'color': '#4e4e52',
                    'horizon-blend': 0.04,
                });

                map.setLight({
                    'anchor': 'viewport',
                    'color': '#8899AA',
                    'intensity': 0.3
                });

                if (!map.getAtmosphere()) {
                    map.setAtmosphere({
                        'skyType': 'atmosphere',
                        'skyAtmosphereColor': '#000000',
                        'skyAtmosphereSun': [0.0, 0.0],
                        'skyAtmosphereSunIntensity': 15
                    });
                }

            });

        });

        </script>


        <script src="{% static 'map/js/vatsim.js' %}"></script>
        <script type="module" src="{% static 'map/js/control.js' %}"></script>
        <script src="{% static 'map/js/airports.js' %}"></script>
        <script src="{% static 'map/js/filters.js' %}"></script>
        <script src="{% static 'map/js/aircraft.js' %}"></script>
        <script src="{% static 'map/js/waypoints.js' %}"></script>
        <script src="{% static 'map/js/search.js' %}"></script>
        <script src="{% static 'map/js/window.js' %}"></script>

        <script src="{% static 'map/js/cardControl.js' %}"></script>
        
        <script>
        /**
        * Main function to draw waypoints and route.
        */
        function drawWaypointsAndRoute() {
            const simBriefApiUrl = 'https://www.simbrief.com/api/xml.fetcher.php?userid={{user.simbrief_id}}&json=1'; 

            fetchFlightPlanData(simBriefApiUrl)
                .then(processAndDrawRoute)
                .catch(error => console.error('Failed to draw waypoints and route:', error));
        }

        drawWaypointsAndRoute();
        </script>
    </body>
</html>
